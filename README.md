### Архитектура базы

![Архитектура базы](/images/relationships.real.large.png)

### Архитектура приложения

![Архитектура приложения](/images/ApplicationStruct.png)

### Запуск
Поднимаем приложение в докере с помощью docker-compose
```
docker-compose up --build -d
```

Используем скрипт, чтобы заполнить базу данными для демонстрации.
```
./scripts/fill_db.py
```

### Using Swagger UI
Go to the http://localhost:8080/docs

При переходе по этому адресу откроется SwagerUI. В этом интерфейсе можно потрогать различные ручки
![SwaggerUI](/images/SvagetUI_1.png)
![SwaggerUI](/images/SvagerUI_2.png)

### Запросы

Для всех таблиц реализованы соответствующие CRUD операции. Для каждой операции реализованы ручки, которые можно дергать через
http запросы или утилиту curl. Более подробный список этих запросов вы можете найти в [нашей документации](/docs/requests.md)

### Авторизация

В этом задании мы будем использовать авторизацию через токен. Авторизация и аутентификация отличаются по своей сути. Аутентификация -- проверка
соответствия имени пользователя его паролю. Авторизация -- проверка прав аутентифицированного пользователя на выполнение того или иного действия.

Для начала регистрируем пользователя, для этого делаем запрос (если у вас уже есть зарегистрированный пользователь, этот шаг можно пропустить).
Этот пользователь будет автоматически добавлен в базу пользователей.
```
curl -X POST "http://localhost:8080/api/register?username=admin&password=admin"
```

После этого получаем токен для пользователя
```
curl -X POST "http://localhost:8080/api/token" -d "username=admin&password=admin"
```
Для удобства сразу сохраним токен в переменную среды
```
export TOKEN=$(curl -s http://localhost:8080/api/token -d username\=admin\&password\=admin | jq -r '.access_token')
```

### Бизнес-задачи

Наша программа будет решать следующие бизнес-задачи

#### Оптимизация распределения задач

Алгоритм, который автоматически распределяет задачи между пользователями на основе их текущей загрузки и навыков.
Получаем наиболее оптимальное распределение открытых задач между пользователями. При этом мы учитываем рейтинг пользователя, сложность задачи,
количество задач, которыми занимается пользователь в данный момент и принадлежность пользователя к проекту, с которым связана задача.

Функции для решения бизнес-задач мы будем вызывать из-под авторизованного пользователя, с помощью аутентификации через токен.

Делаем запрос с аутентификацией и запросом к решению задачи
```
curl -X GET "http://localhost:8080/api/auth/task-distribution" -H "Authorization: Bearer $TOKEN" | jq .
```

Результат работы алгоритма мы получаем в виде json соответствия: каждому ключу - идентификатору пользователя соответствуют идентификаторы задач, которые
стоит ему назначить. Далее мы можем это сделать отдельным запросом. Не забудьте про токен аутентификации.
```
curl -X POST http://localhost:8080/api/auth/apply-distribution \
    -H "Content-Type: application/json" \
    -H "Authorization: Bearer $TOKEN" \
    -d "{\"10\":[32,43,49], \
         \"24\":[5], \
         \"44\":[13], \
         \"74\":[38], \
         \"103\":[48], \
         \"115\":[29], \
         \"127\":[25], \
         \"186\":[42]}" | jq .
```

#### Система приоритетов задач

Алгоритм устанавливаем приоритеты для задач, учитывая сроки выполнения и сложность задачи.
```
curl -X GET "http://localhost:8080/api/auth/ranked-tasks" -H "Authorization: Bearer $TOKEN" | jq .
```
Аналогичный алгоритм для проектов
```
curl -X GET "http://localhost:8080/api/auth/ranked-projects" -H "Authorization: Bearer $TOKEN" | jq .
```

#### Тестирование продукта

В проекте предусмотрин запуск юнит-тестов, которые тестируют базовую логику. Юнит-тесты применяются для проверки базовой функциональности
в процессе жизненного цикла продукта, чтобы проверить, что базовые функции сохраняют ожидаемый от них результат.

Для запуска тестов мы используем отдельный сервис в docker-compose. Для того, чтобы запустить контейнер с тестированием, нужно запустить
docker-compose с профилем with-tests. После прогонки тестов в дериктории test_report вы сможете найти результаты прохождения тестов и данные о 
покрытии.
```
docker-compose --profile with-test up -d --build
```

![Тесты в докере](/images/ApplicationStructExtended.png)

Кроме того, можно использовать внешние приложения для тестирования Rest API, такие как Postman

![Тесты в postman](/images/PostmanTests_1.png)

![Тесты в postman](/images/PostmanTests_2.png)

![Тесты в postman](/images/PostmanTesing.png)

Отчеты от покрытии кода

![Отчет о покрытии](/images/CodeCoverage.png)

#### For developers

Python code formating. We're using pyformat 
```
pyformat -i -r -a --remove-all-unused-imports --remove-unused-variables ./
```
and check code quality via pylint
```
pylint ./ > pylint_report.txt
```

Отчет линтера
![Отчет линтера](/images/LinterReport.png)